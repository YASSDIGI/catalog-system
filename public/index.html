<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚µãƒ¼ãƒ“ã‚¹ã‚«ã‚¿ãƒ­ã‚° | TOE</title>
  <meta name="description" content="Webåˆ¶ä½œãƒ»AIé–‹ç™ºãƒ»å‹•ç”»åˆ¶ä½œãƒ»SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã€‚TOEã®ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ã‚’ã”è¦§ãã ã•ã„ã€‚" />
  <meta property="og:title" content="ã‚µãƒ¼ãƒ“ã‚¹ã‚«ã‚¿ãƒ­ã‚° | TOE" />
  <meta property="og:description" content="Webåˆ¶ä½œã‹ã‚‰AIå°å…¥ã¾ã§ã€ãƒ“ã‚¸ãƒã‚¹ã®æˆé•·ã‚’åŠ é€Ÿã•ã›ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700;900&family=Cormorant+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --ink: #0a0a0a; --paper: #faf9f7; --stone: #6b6560; --mist: #e8e5e0;
      --accent: #c4553a; --card-bg: #fff;
      --font-jp: 'Zen Kaku Gothic New', sans-serif;
      --font-display: 'Cormorant Garamond', serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { font-family: var(--font-jp); background: var(--paper); color: var(--ink); line-height: 1.8; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
    ::selection { background: var(--accent); color: #fff; }

    .hero { position: relative; padding: 120px 40px 80px; text-align: center; overflow: hidden; }
    .hero::before { content: ''; position: absolute; top: -200px; right: -150px; width: 600px; height: 600px; background: radial-gradient(circle, rgba(196,85,58,0.06) 0%, transparent 70%); border-radius: 50%; pointer-events: none; }
    .hero-label { display: inline-block; font-size: 11px; font-weight: 700; letter-spacing: 4px; text-transform: uppercase; color: var(--accent); margin-bottom: 24px; animation: fadeDown 0.8s ease both; }
    .hero-label::before, .hero-label::after { content: ''; display: inline-block; width: 32px; height: 1px; background: var(--accent); vertical-align: middle; margin: 0 16px; opacity: 0.5; }
    .hero h1 { font-family: var(--font-display); font-size: clamp(42px, 7vw, 80px); font-weight: 400; letter-spacing: -1px; line-height: 1.15; margin-bottom: 8px; animation: fadeUp 0.8s ease 0.1s both; }
    .hero-sub { font-size: clamp(14px, 2vw, 17px); color: var(--stone); max-width: 520px; margin: 0 auto 40px; animation: fadeUp 0.8s ease 0.2s both; }
    .hero-stats { display: flex; justify-content: center; gap: 48px; animation: fadeUp 0.8s ease 0.3s both; }
    .hero-stat-num { font-family: var(--font-display); font-size: 36px; font-weight: 600; line-height: 1; }
    .hero-stat-label { font-size: 12px; color: var(--stone); margin-top: 4px; letter-spacing: 1px; }
    .hero-divider { width: 1px; height: 40px; background: var(--mist); align-self: center; }

    .filter-section { max-width: 1100px; margin: 0 auto; padding: 0 40px 32px; animation: fadeUp 0.8s ease 0.4s both; }
    .filter-bar { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .filter-btn { padding: 9px 22px; border: 1.5px solid var(--mist); border-radius: 100px; background: transparent; font-family: var(--font-jp); font-size: 13px; font-weight: 500; color: var(--stone); cursor: pointer; transition: all 0.25s; white-space: nowrap; }
    .filter-btn:hover { border-color: var(--ink); color: var(--ink); }
    .filter-btn.active { background: var(--ink); border-color: var(--ink); color: #fff; }
    .filter-count { margin-left: auto; font-size: 13px; color: var(--stone); font-weight: 500; }
    .search-wrap { position: relative; }
    .search-wrap svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--stone); pointer-events: none; }
    .search-input { padding: 9px 18px 9px 40px; border: 1.5px solid var(--mist); border-radius: 100px; background: transparent; font-family: var(--font-jp); font-size: 13px; color: var(--ink); outline: none; width: 200px; transition: all 0.25s; }
    .search-input:focus { border-color: var(--ink); width: 260px; }
    .search-input::placeholder { color: #b5b0aa; }

    .catalog { max-width: 1100px; margin: 0 auto; padding: 0 40px 80px; }
    .catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px; }
    .card { background: var(--card-bg); border-radius: 6px; border: 1px solid rgba(0,0,0,0.05); overflow: hidden; transition: all 0.35s cubic-bezier(0.25,0.46,0.45,0.94); opacity: 0; transform: translateY(24px); animation: cardReveal 0.6s ease forwards; }
    .card:nth-child(1){animation-delay:.05s}.card:nth-child(2){animation-delay:.1s}.card:nth-child(3){animation-delay:.15s}.card:nth-child(4){animation-delay:.2s}.card:nth-child(5){animation-delay:.25s}.card:nth-child(6){animation-delay:.3s}.card:nth-child(7){animation-delay:.35s}.card:nth-child(8){animation-delay:.4s}
    .card:hover { transform: translateY(-6px); box-shadow: 0 12px 40px rgba(10,10,10,0.08); border-color: transparent; }
    .card-accent { height: 4px; width: 100%; transition: height 0.3s; }
    .card:hover .card-accent { height: 6px; }
    .card-img { width: 100%; height: 180px; object-fit: cover; display: block; }
    .card-body { padding: 28px 28px 24px; }
    .card-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; }
    .card-category { font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; }
    .card-sku { font-family: var(--font-display); font-size: 13px; color: #b5b0aa; font-weight: 500; }
    .card-title { font-size: 19px; font-weight: 900; line-height: 1.4; margin-bottom: 10px; }
    .card-desc { font-size: 14px; color: var(--stone); line-height: 1.75; margin-bottom: 20px; }
    .card-footer { display: flex; align-items: flex-end; justify-content: space-between; padding-top: 18px; border-top: 1px solid rgba(0,0,0,0.05); }
    .card-price { font-family: var(--font-display); font-size: 30px; font-weight: 600; line-height: 1; }
    .card-price-yen { font-size: 16px; font-weight: 400; color: var(--stone); }
    .card-unit { font-size: 13px; color: var(--stone); margin-left: 2px; }
    .card-cta { display: inline-flex; align-items: center; gap: 8px; padding: 10px 22px; border: 1.5px solid var(--ink); border-radius: 100px; background: transparent; font-family: var(--font-jp); font-size: 12px; font-weight: 700; color: var(--ink); cursor: pointer; transition: all 0.25s; text-decoration: none; letter-spacing: 0.5px; }
    .card-cta:hover { background: var(--ink); color: #fff; }
    .card-cta svg { transition: transform 0.25s; }
    .card-cta:hover svg { transform: translateX(3px); }

    .empty, .loading-state { text-align: center; padding: 80px 20px; grid-column: 1 / -1; }
    .empty p, .loading-state p { color: var(--stone); font-size: 15px; }
    .spinner { width: 32px; height: 32px; border: 3px solid var(--mist); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.7s linear infinite; margin: 0 auto 16px; }

    .cta-section { max-width: 1100px; margin: 0 auto 80px; padding: 0 40px; }
    .cta-box { background: var(--ink); border-radius: 12px; padding: 60px 48px; text-align: center; position: relative; overflow: hidden; }
    .cta-box::before { content: ''; position: absolute; top: -80px; right: -80px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(196,85,58,0.25) 0%, transparent 70%); border-radius: 50%; }
    .cta-box h2 { font-family: var(--font-display); font-size: clamp(28px, 4vw, 40px); font-weight: 400; color: #fff; margin-bottom: 12px; position: relative; }
    .cta-box p { font-size: 15px; color: rgba(255,255,255,0.6); margin-bottom: 32px; position: relative; }
    .cta-button { display: inline-flex; align-items: center; gap: 10px; padding: 16px 36px; background: #fff; color: var(--ink); border: none; border-radius: 100px; font-family: var(--font-jp); font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.25s; text-decoration: none; position: relative; }
    .cta-button:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.3); }

    .footer { text-align: center; padding: 32px 40px; border-top: 1px solid var(--mist); font-size: 12px; color: var(--stone); letter-spacing: 1px; }
    .error-banner { max-width: 600px; margin: 80px auto; padding: 40px; text-align: center; background: #fff; border-radius: 12px; border: 1px solid var(--mist); }
    .error-banner h2 { font-size: 20px; margin-bottom: 12px; }
    .error-banner p { color: var(--stone); font-size: 14px; line-height: 1.7; }
    .error-banner input { width: 100%; padding: 11px 14px; border: 1.5px solid var(--mist); border-radius: 10px; font-size: 14px; outline: none; margin-top: 12px; font-family: 'DM Sans', monospace; background: #fafafa; }
    .error-banner input:focus { border-color: var(--ink); background: #fff; }
    .error-banner button { padding: 12px 32px; border: none; border-radius: 100px; background: var(--ink); color: #fff; font-size: 14px; font-weight: 700; cursor: pointer; font-family: var(--font-jp); transition: all 0.2s; }
    .error-banner button:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }

    @keyframes fadeUp { from { opacity:0; transform:translateY(20px) } to { opacity:1; transform:translateY(0) } }
    @keyframes fadeDown { from { opacity:0; transform:translateY(-10px) } to { opacity:1; transform:translateY(0) } }
    @keyframes cardReveal { to { opacity:1; transform:translateY(0) } }
    @keyframes spin { to { transform:rotate(360deg) } }

    @media (max-width:768px) {
      .hero{padding:80px 24px 48px} .hero-stats{gap:24px} .hero-stat-num{font-size:28px}
      .filter-section,.catalog,.cta-section{padding-left:20px;padding-right:20px}
      .catalog-grid{grid-template-columns:1fr} .card-body{padding:22px} .card-price{font-size:26px}
      .cta-box{padding:40px 24px} .hero-divider{display:none}
      .search-input,.search-input:focus{width:100%}
    }
    @media (max-width:480px) { .hero-stats{flex-direction:column;gap:16px} .filter-count{display:none} }
  </style>
</head>
<body>
<div id="app">
  <div class="loading-state" style="padding:200px 20px">
    <div class="spinner"></div>
    <p>ã‚«ã‚¿ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
  </div>
</div>

<script>
// ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ãŒæ³¨å…¥ã•ã‚Œã‚‹ã€‚æœªæ³¨å…¥ãªã‚‰localStorageã‹ã‚‰å–å¾—
const _buildUrl = '__SUPABASE_URL__';
const _buildKey = '__SUPABASE_ANON_KEY__';
const SUPABASE_URL = (_buildUrl && _buildUrl !== '__' + 'SUPABASE_URL' + '__') ? _buildUrl : (localStorage.getItem('catalog_sb_url') || '');
const SUPABASE_ANON_KEY = (_buildKey && _buildKey !== '__' + 'SUPABASE_ANON_KEY' + '__') ? _buildKey : (localStorage.getItem('catalog_sb_key') || '');

const CONTACT_EMAIL = 'info@example.com'; // â† ãŠå•ã„åˆã‚ã›å…ˆãƒ¡ãƒ¼ãƒ«
const COMPANY_NAME = 'TOE Inc.';

let sb, allItems = [], allCategories = [], activeCategory = 'all', searchQuery = '';

function fmtPrice(p) { return p >= 10000 ? (p/10000) + '' : p.toLocaleString(); }
function fmtUnit(p) { return p >= 10000 ? 'ä¸‡å††' : 'å††'; }

const arrowSvg = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>';
const searchSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>';

async function init() {
  const app = document.getElementById('app');

  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
    app.innerHTML = `
      <div class="error-banner">
        <h2>ğŸ“¦ Supabaseæ¥ç¶šè¨­å®š</h2>
        <p>Supabase Dashboard â†’ Settings â†’ API ã‹ã‚‰<br>Project URL ã¨ anon key ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
        <input id="setup-url" placeholder="https://xxxxx.supabase.co" value="${localStorage.getItem('catalog_sb_url')||''}" />
        <input id="setup-key" placeholder="eyJhbGciOiJIUzI1NiIs..." value="${localStorage.getItem('catalog_sb_key')||''}" style="margin-bottom:20px" />
        <button onclick="
          var u=document.getElementById('setup-url').value.trim().replace(/\\/+$/,'');
          var k=document.getElementById('setup-key').value.trim();
          if(!u||!k){alert('ä¸¡æ–¹å…¥åŠ›ã—ã¦ãã ã•ã„');return;}
          localStorage.setItem('catalog_sb_url',u);
          localStorage.setItem('catalog_sb_key',k);
          location.reload();
        ">æ¥ç¶šã™ã‚‹</button>
        <p style="margin-top:16px;font-size:12px;color:#b5b0aa">Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯ç’°å¢ƒå¤‰æ•°ã§è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™</p>
      </div>`;
    return;
  }

  sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  try {
    const [catRes, itemRes] = await Promise.all([
      sb.from('catalog_categories').select('*').order('sort_order'),
      sb.from('catalog_items').select('*, catalog_categories(name, color)').eq('status', 'active').order('sort_order'),
    ]);
    if (catRes.error) throw catRes.error;
    if (itemRes.error) throw itemRes.error;

    allCategories = catRes.data || [];
    allItems = (itemRes.data || []).map(i => ({
      ...i,
      category_name: i.catalog_categories?.name || '',
      category_color: i.catalog_categories?.color || '#999',
    }));
    renderPage();
  } catch (e) {
    console.error('Connection error:', e);
    const isNetwork = e.message === 'Failed to fetch' || e.message?.includes('fetch') || e.message?.includes('NetworkError');
    app.innerHTML = `<div class="error-banner">
      <h2>${isNetwork ? 'âš ï¸ æ¥ç¶šã§ãã¾ã›ã‚“' : 'âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼'}</h2>
      ${isNetwork ? `
        <p>Supabaseã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
        <ul style="text-align:left;max-width:420px;margin:16px auto;font-size:13px;color:var(--stone);line-height:2.2;list-style:none;padding:0">
          <li>âœ… Supabase URLãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆæœ«å°¾ã® / ã¯ä¸è¦ï¼‰</li>
          <li>âœ… Anon KeyãŒæ­£ã—ã„ã‹ç¢ºèª</li>
          <li>âœ… Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ <strong>Active</strong> çŠ¶æ…‹ã‹ç¢ºèª</li>
          <li>ğŸ’¡ <strong>Claudeãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯å¤–éƒ¨APIæ¥ç¶šã¯ä¸å¯</strong>ã§ã™ã€‚<br>HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ãã‹ã€Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãã ã•ã„</li>
        </ul>
        <p style="font-size:11px;color:#b5b0aa;margin-bottom:20px">æ¥ç¶šå…ˆ: ${SUPABASE_URL}</p>
      ` : `<p style="margin-bottom:20px">${e.message}</p>`}
      <button onclick="localStorage.removeItem('catalog_sb_url');localStorage.removeItem('catalog_sb_key');location.reload();">æ¥ç¶šè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>`;
  }
}

function renderPage() {
  const filtered = getFiltered();
  const minPrice = allItems.length > 0 ? Math.min(...allItems.map(i => i.price)) : 0;

  document.getElementById('app').innerHTML = `
    <section class="hero">
      <div class="hero-label">Service Catalog</div>
      <h1>Services</h1>
      <p class="hero-sub">Webåˆ¶ä½œã‹ã‚‰AIå°å…¥ã¾ã§ã€ãƒ“ã‚¸ãƒã‚¹ã®æˆé•·ã‚’åŠ é€Ÿã•ã›ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã”æä¾›ã—ã¾ã™ã€‚</p>
      <div class="hero-stats">
        <div class="hero-stat"><div class="hero-stat-num">${allItems.length}</div><div class="hero-stat-label">ã‚µãƒ¼ãƒ“ã‚¹</div></div>
        <div class="hero-divider"></div>
        <div class="hero-stat"><div class="hero-stat-num">${allCategories.length}</div><div class="hero-stat-label">ã‚«ãƒ†ã‚´ãƒª</div></div>
        <div class="hero-divider"></div>
        <div class="hero-stat"><div class="hero-stat-num">${minPrice ? fmtPrice(minPrice)+fmtUnit(minPrice)+'ã€œ' : 'â€”'}</div><div class="hero-stat-label">ç¨æŠœä¾¡æ ¼</div></div>
      </div>
    </section>
    <section class="filter-section">
      <div class="filter-bar">
        <div class="search-wrap">${searchSvg}<input type="text" class="search-input" placeholder="ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¤œç´¢..." value="${searchQuery}" id="searchInput"></div>
        <button class="filter-btn${activeCategory==='all'?' active':''}" data-cat="all">ã™ã¹ã¦</button>
        ${allCategories.map(c=>`<button class="filter-btn${activeCategory===c.id?' active':''}" data-cat="${c.id}">${c.name}</button>`).join('')}
        <span class="filter-count" id="filterCount">${filtered.length} ã‚µãƒ¼ãƒ“ã‚¹</span>
      </div>
    </section>
    <section class="catalog"><div class="catalog-grid" id="grid">${renderCards(filtered)}</div></section>
    <section class="cta-section">
      <div class="cta-box">
        <h2>Get in Touch</h2>
        <p>ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹ã”è³ªå•ã‚„ãŠè¦‹ç©ã‚‚ã‚Šã®ã”ç›¸è«‡ã¯ãŠæ°—è»½ã«ã©ã†ãã€‚</p>
        <a href="mailto:${CONTACT_EMAIL}" class="cta-button">ãŠå•ã„åˆã‚ã› ${arrowSvg}</a>
      </div>
    </section>
    <footer class="footer">&copy; ${new Date().getFullYear()} ${COMPANY_NAME}. All Rights Reserved.</footer>`;

  // Event listeners
  document.getElementById('searchInput').addEventListener('input', e => { searchQuery = e.target.value; updateGrid(); });
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      activeCategory = btn.dataset.cat;
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      updateGrid();
    });
  });
}

function getFiltered() {
  const q = searchQuery.toLowerCase();
  return allItems.filter(i =>
    (activeCategory === 'all' || i.category_id === activeCategory) &&
    (!q || i.name.toLowerCase().includes(q) || (i.description||'').toLowerCase().includes(q) || (i.sku||'').toLowerCase().includes(q))
  );
}

function renderCards(items) {
  if (!items.length) return '<div class="empty"><p>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“</p></div>';
  return items.map((item, i) => {
    const c = item.category_color;
    const imgHtml = item.image_url ? `<img class="card-img" src="${item.image_url}" alt="${item.name}" loading="lazy">` : '';
    return `<div class="card" style="animation-delay:${i*0.06}s">
      <div class="card-accent" style="background:${c}"></div>
      ${imgHtml}
      <div class="card-body">
        <div class="card-header"><span class="card-category" style="color:${c}">${item.category_name||'æœªåˆ†é¡'}</span><span class="card-sku">${item.sku||''}</span></div>
        <h3 class="card-title">${item.name}</h3>
        <p class="card-desc">${item.description||''}</p>
        <div class="card-footer">
          <div><span class="card-price-yen">Â¥</span><span class="card-price">${fmtPrice(item.price)}</span><span class="card-price-yen">${fmtUnit(item.price)}</span><span class="card-unit">/ ${item.unit==='æœˆ'?'æœˆé¡':item.unit}</span></div>
          <a href="mailto:${CONTACT_EMAIL}?subject=${encodeURIComponent(item.name+'ã«ã¤ã„ã¦')}" class="card-cta">ãŠå•ã„åˆã‚ã› ${arrowSvg}</a>
        </div>
      </div>
    </div>`;
  }).join('');
}

function updateGrid() {
  const f = getFiltered();
  document.getElementById('grid').innerHTML = renderCards(f);
  document.getElementById('filterCount').textContent = f.length + ' ã‚µãƒ¼ãƒ“ã‚¹';
}

init();
</script>
</body>
</html>
